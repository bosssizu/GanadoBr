
<!doctype html><html lang="es"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GanadoBravo — Evaluación</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f7f7fb;margin:0}
.container{max-width:1120px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns:320px 1fr;gap:24px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:16px}
h1{margin:0 0 8px} .btn{background:#0b63f6;color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
h2{margin-top:0} .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.badge{display:inline-block;background:#eef2ff;color:#334; padding:6px 10px;border-radius:10px;font-weight:600}
.score{font-weight:700} .ok{color:#1a7f37} .warn{color:#b7791f} .bad{color:#9b1c1c}
.small{color:#666;font-size:12px}
.table{width:100%;border-collapse:collapse;font-size:14px} .table td{padding:8px;border-bottom:1px solid #eee}
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px}
.dot.ok{background:#16a34a} .dot.bad{background:#dc2626}
.preview{width:100%;height:220px;background:#f1f1f6;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.preview img{max-width:100%;max-height:100%;}
.decision{font-size:28px;font-weight:900}
</style></head>
<body><div class="container">
<div class="card">
  <h2>Entrada</h2>
  <div>Imagen (JPG/PNG)</div>
  <input id="file" type="file" accept="image/*"/><br/><br/>
  <div>Modo</div>
  <select id="mode">
    <option value="levante">Levante (default)</option>
    <option value="vaca_flaca">Vaca flaca</option>
    <option value="engorde">Engorde</option>
  </select><br/><br/>
  <button class="btn" id="eval">Evaluar</button>
  <br/><br/>
  <div class="preview" id="preview"><span class="small">vista previa</span></div>
  <br/>
  <div class="small">Notas y razones</div>
  <ul class="small" id="reasons"></ul>
</div>

<div class="card">
  <h2>Resultado</h2>
  <div class="grid">
    <div>
      <div id="decision" class="decision">—</div>
      <div>BCS <span id="bcs">—</span></div>
    </div>
    <div class="grid">
      <div class="badge">Puntaje global: <span id="gscore">—</span></div>
      <div class="badge">Riesgo: <span id="risk">—</span></div>
    </div>
  </div>
  <hr/>
  <h3>Rúbrica detallada</h3>
  <table class="table" id="rub"></table>
  <h3>Salud</h3>
  <ul id="health"></ul>
  <h3>Raza</h3>
  <div id="breed" class="small">—</div>
</div>
</div>
<script>
const f=$=>document.getElementById($);
f('file').addEventListener('change',e=>{
  const file=e.target.files[0]; if(!file)return;
  const img=document.createElement('img'); img.src=URL.createObjectURL(file);
  const pv=f('preview'); pv.innerHTML=''; pv.appendChild(img);
});
function color(v){ if(v>=7.2) return 'ok'; if(v>=6) return 'warn'; return 'bad'; }
f('eval').onclick=async ()=>{
  const file=f('file').files[0]; if(!file){alert('Carga una imagen'); return;}
  const fd=new FormData(); fd.append('file',file); fd.append('mode',f('mode').value);
  const res=await fetch('/evaluate',{method:'POST',body:fd});
  const data=await res.json();
  if(!res.ok && data.status==='error'){ alert('Error: '+JSON.stringify(data)); return;}
  f('decision').textContent='Decisión: '+(data.decision_text||'—');
  f('bcs').textContent=data.bcs?.toFixed?data.bcs.toFixed(2):data.bcs;
  f('gscore').textContent=data.global_score?.toFixed?data.global_score.toFixed(2):data.global_score;
  f('risk').textContent=data.risk;
  const rub=f('rub'); rub.innerHTML='';
  (data.rubric||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.name}</td><td class="score ${color(r.score)}">${r.score.toFixed(2)}</td><td>${r.obs||'Correcta'}</td>`;
    rub.appendChild(tr);
  });
  const hl=f('health'); hl.innerHTML=''; (data.health||[]).forEach(h=>{
    const li=document.createElement('li'); li.innerHTML=`<span class="dot ok"></span>${h.name} = ${h.status==='descartado'?'Descartado':'Revisar'}`; hl.appendChild(li);
  });
  const br=f('breed');
  if(data.breed){
    const fam = data.breed.family? ` · ${data.breed.family}`: '';
    const dom = data.breed.dominant && data.breed.dominant!=='ninguno'? ` · predomina ${data.breed.dominant}`: '';
    br.textContent=`${data.breed.name||'—'} · conf=${(data.breed.confidence??0).toFixed(2)}${fam}${dom}${data.breed.explanation?(' — '+data.breed.explanation):''}`;
  } else { br.textContent='—'; }
  const rs=f('reasons'); rs.innerHTML=''; (data.reasons||[]).forEach(x=>{const li=document.createElement('li'); li.textContent=x; rs.appendChild(li);});
};
</script>
</body></html>
